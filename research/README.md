# Сравнение производительности баз данных: PostgreSQL против MongoDB

## Введение

В данном документе представлены результаты сравнения производительности PostgreSQL и MongoDB для хранения данных о рейтингах фильмов, отзывах и закладках пользователей. Тесты были проведены для измерения скорости вставки данных и выполнения определенных операций.

### Настройка теста:

- Версия PostgreSQL: 15-alpine
- Версия MongoDB: 4.4.23-rc0-focal
- Количество записей: 15 000 000

### Скорость вставки данных:

##### PostgreSQL

- Среднее время выполнения для `insert_data`: 0.130001 секунд
- Среднее время выполнения для `insert_data`: 0.106000 секунд
- Среднее время выполнения для `insert_data`: 0.069002 секунд

##### MongoDB

- Среднее время выполнения для `insert_data`: 0.073466 секунд
- Среднее время выполнения для `insert_data`: 0.050629 секунд
- Среднее время выполнения для `insert_data`: 0.067823 секунд

### Количество лайков:

##### PostgreSQL

- Время выполнения для `count_likes`: 0.428624 секунд

##### MongoDB

- Время выполнения для `count_likes`: 0.005413 секунд

### Расчет средней оценки:

##### PostgreSQL

- Время выполнения для `calculate_average_rating`: 0.435518 секунд

##### MongoDB

- Время выполнения для `calculate_average_rating`: 0.003385 секунд

### Закладки пользователей:

##### PostgreSQL

- Время выполнения для `get_user_bookmarks`: 0.001000 секунд

##### MongoDB

- Время выполнения для `get_user_bookmarks`: 0.004224 секунд

## Заключение

На основе результатов данного сравнения производительности MongoDB продемонстрировала более высокую скорость вставки данных и эффективное выполнение запросов для конкретных операций, таких как подсчет лайков, расчет средних оценок и получение закладок пользователей. Эти выводы свидетельствуют о том, что MongoDB подходит для сценариев, требующих быстрой вставки данных и гибких запросов.

# Решение об использовании MongoDB и Kafka в архитектуре сервиса

### MongoDB для сбора информации о лайках, закладках и отзывах

При сборе информации о лайках, закладках пользователей и отзывах, требуется гибкая структура данных для обработки различных типов информации. MongoDB, как документоориентированная база данных, предоставляет возможность хранить полуструктурированные данные без строгой схемы. Это позволяет нам эффективно хранить разнообразные события, связанные с пользователями и фильмами, без необходимости определения фиксированной структуры.

Преимущества использования MongoDB для сбора информации:

- Гибкая схема данных для хранения разнообразных событий.
- Удобный механизм индексации и быстрый доступ к данным.
- Простота масштабирования, позволяющая обрабатывать большие объемы данных.

### Kafka для записи событий и аналитики

Apache Kafka предоставляет высокопроизводительную платформу для потоковой обработки данных и событийной архитектуры. Он идеально подходит для записи событий о просмотренных фильмах, времени их просмотра и других событий, необходимых для проведения аналитики. Kafka обеспечивает надежную и масштабируемую передачу данных между различными компонентами системы.

Преимущества использования Kafka для записи событий и аналитики:

- Высокая пропускная способность для обработки больших объемов событий.
- Надежная доставка событий с поддержкой репликации и репартицирования.
- Возможность обработки данных в реальном времени и поддержка аналитики на основе потоков данных.

### Преимущества разделения баз данных

Использование разных баз данных в рамках одного сервиса позволяет достичь следующих преимуществ:

1. **Чистота и Простота**: Разделение баз данных уменьшает сложность кода и архитектуры сервиса. Каждая база данных может быть настроена оптимально для своего типа данных, что упрощает обслуживание и поддержку.

2. **Масштабируемость**: Можно масштабировать каждую базу данных отдельно в зависимости от потребностей и нагрузки.

3. **Изоляция событий**: Разделение баз данных обеспечивает изоляцию событий разных типов, предотвращая влияние сбоев или нагрузки в одной базе данных на другие.

4. **Гибкость в Развитии**: При необходимости можно легко вносить изменения в одну базу данных без влияния на другую.

## Выводы

Выбор разработки сервиса с использованием MongoDB для сбора информации о лайках, закладках и отзывах, а также Kafka для записи событий и аналитики, обоснован высокой производительностью и гибкостью обеих технологий. Разделение баз данных позволяет эффективно управлять разнообразными данными и событиями, упрощает архитектуру сервиса и способствует его масштабируемости.

# Решение об использовании отдельных сервисов для каждой базы данных

### Разделение Обязанностей

Использование отдельных сервисов для каждой базы данных позволяет четко разделить обязанности и функциональность, что способствует более ясной архитектуре и легкости поддержки.

1. **Модульность и Расширяемость**: Каждый сервис сосредоточен на своей задаче, что упрощает добавление новых функций и изменение существующих без воздействия на другие части системы.

2. **Управляемость**: Отдельные сервисы могут быть масштабированы, настроены и обслуживаемы независимо, обеспечивая легкость управления системой.

### Производительность и масштабируемость

Использование отдельных сервисов для каждой базы данных способствует оптимизации производительности и обеспечивает масштабируемость.

1. **Оптимизация для Конкретных Типов Данных**: Каждая база данных оптимизирована для конкретных типов операций и данных. Разделение баз данных позволяет использовать наилучшие практики для каждой из них.

2. **Горизонтальное Масштабирование**: Разные базы данных могут масштабироваться по-разному. Отдельные сервисы обеспечивают возможность горизонтального масштабирования для каждой базы по отдельности.

### Улучшенная устойчивость и изоляция

Использование отдельных сервисов для каждой базы данных обеспечивает улучшенную устойчивость и изоляцию.

1. **Изоляция Ошибок**: Проблемы, возникающие в одном сервисе, не будут негативно влиять на работу других сервисов. Это уменьшает риск каскадного сбоя.

2. **Более Четкая Обработка Ошибок**: Обработка ошибок становится более четкой, так как каждый сервис имеет ограниченную функциональность и ответственность.

### Облегчение тестирования и разработки

Использование отдельных сервисов упрощает процессы тестирования и разработки.

1. **Независимость Тестирования**: Каждый сервис может быть тестирован независимо, что облегчает выявление и устранение ошибок.

2. **Упрощенное Обновление**: Развертывание обновлений и изменений проще для отдельных сервисов, так как нет необходимости беспокоиться о влиянии на другие компоненты.

## Выводы

Выбор использования отдельных сервисов для каждой базы данных (MongoDB и Kafka) обоснован преимуществами в модульности, производительности, устойчивости и управляемости. Этот подход способствует более четкой и гибкой архитектуре, упрощает разработку и обслуживание системы, а также предоставляет возможность эффективно масштабировать и оптимизировать различные типы данных и операций.
